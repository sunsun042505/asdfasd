<!doctype html><html lang="ko"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>배송조회</title><link rel="stylesheet" href="./style.css"></head>
<body><div class="wrap">
<div class="topbar">
  <div><div class="title">배송조회</div><div class="sub">build 2025-12-31 15:48:00 KST</div></div>
  <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
    <span class="pill" id="clock">--:--:--</span>
    <button class="btn" onclick="location.href='./index.html'">메인</button>
  </div>
</div>

<div class="card">
  <div class="row">
    <div><input id="inv" class="mono" placeholder="81xxxxxxxxxxxxxxxx"></div>
    <div><button class="btn primary" id="go" style="width:100%;">조회</button></div>
  </div>
  <div class="sub" id="msg" style="margin-top:10px;"></div>
</div>

<div class="card" id="res" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
    <b>조회 결과</b><span class="pill mono" id="wb">-</span>
  </div>
  <div class="hr"></div>
  <div class="grid3">
    <div><div class="sub">서비스</div><div id="svc" style="font-weight:900;"></div></div>
    <div><div class="sub">배송사</div><div id="carrier" style="font-weight:900;"></div></div>
    <div><div class="sub">상태</div><div id="status" style="font-weight:900;"></div></div>
  </div>
  <div class="row" style="margin-top:10px;">
    <div><div class="sub">보내는분</div><div id="sender" style="font-weight:900;"></div></div>
    <div><div class="sub">받는분</div><div id="receiver" style="font-weight:900;"></div></div>
  </div>
  <div class="row" style="margin-top:10px;">
    <div><div class="sub">무게</div><div id="w" style="font-weight:900;"></div></div>
    <div><div class="sub">접수지점</div><div id="store" style="font-weight:900;"></div></div>
  </div>

  <div class="hr"></div>
  <b>배송흐름</b>
  <div id="tl" class="list"></div>
</div>

<script type="module">
import * as c from "./client.js";

document.addEventListener("DOMContentLoaded", ()=>{
  c.startClock(c.$("clock"));

  const run=async(inv, push)=>{
    c.$("msg").textContent="";
    inv=c.digitsOnly(inv);
    if(inv.length!==18){ c.$("msg").innerHTML="<span class='err'>18자리 숫자만</span>"; return; }
    if(push){
      const u=new URL(location.href);
      u.searchParams.set("invoice_no",inv);
      history.replaceState(null,"",u.toString());
    }
    c.$("inv").value=inv;
    try{
      const rec=await c.apiGet("/api/reservations/byWaybill/"+encodeURIComponent(inv));
      c.$("res").style.display="";
      c.$("wb").textContent=rec.waybillNo;
      c.$("svc").textContent=c.typeLabel(rec.type);
      c.$("carrier").textContent=c.carrierLabel(rec.type);
      c.$("status").textContent=rec.status||"-";
      c.$("sender").textContent=(rec.sender?.name||"-")+" ("+(rec.sender?.phone||"-")+")";
      c.$("receiver").textContent=(rec.receiver?.name||"-")+" ("+(rec.receiver?.phone||"-")+")";
      c.$("w").textContent=(rec.package?.weightKg ?? "-")+" kg";
      c.$("store").textContent=rec.storeName || "-";

      const tl=c.$("tl"); tl.innerHTML="";
      (rec.events||[]).forEach(e=>{
        const div=document.createElement("div");
        div.className="item";
        div.innerHTML=`<b>${e.place} ${e.message}</b><div class="sub">${e.time}</div>`;
        tl.appendChild(div);
      });
    }catch(e){
      c.$("res").style.display="none";
      c.$("msg").innerHTML="<span class='err'>등록된 운송장이 아님</span> (키오스크에서 발급/접수 후 조회)";
    }
  };

  c.$("go").onclick=()=>run(c.$("inv").value,true);
  const q=new URL(location.href).searchParams.get("invoice_no");
  if(q) run(q,false);
});
</script>
</body></html>
